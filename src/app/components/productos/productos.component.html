<div class="container mt-5 text-center">
    <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show">
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = ''"></button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show">
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <h3 class="mt-5">Productos</h3>

  <div class="d-flex justify-content-center">
    <button (click)="toggleForm()" class="btn btn-success">
      <i class="fa-solid fa-plus"></i>
      Registrar Producto
    </button>
  </div>


  <div *ngIf="loading && !productos.length" class="text-center p-3 mt-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando productos...</p>
  </div>


  <div *ngIf="!loading && !productos.length" class="alert alert-info mt-4">
    No hay productos disponibles.
  </div>


  <table *ngIf="productos.length" class="table table-bordered mt-4">
    <thead class="table-success">
    <tr>
      <th>#</th>
      <th>Nombre</th>
      <th>Descripcion</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let producto of productos; let i = index" style="text-align: center;">
      <td>{{ i + 1 }}</td>
      <td>{{ producto.nombre }}</td>
      <td>{{ producto.descripcion }}</td>
      <td>{{ producto.precio | currency }}</td>
      <td>
          <span [ngClass]="{'text-danger': producto.stock <= 5, 'text-warning': producto.stock > 5 && producto.stock <= 20}">
            {{ producto.stock }}
          </span>
      </td>
      <td>
        <button class="btn btn-primary btn-sm me-1" (click)="editProducto(producto)">
          <i class="fas fa-edit me-1"></i> Editar
        </button>
        <button class="btn btn-danger btn-sm me-1" (click)="deleteProducto(producto.id)">
          <i class="fas fa-trash me-1"></i> Eliminar
        </button>
      </td>
    </tr>
    </tbody>
  </table>


  <div *ngIf="showForm" style="margin-top: 20px;">
    <h3 class="text-center">{{ textoModal }}</h3>

    <form [formGroup]="productoForm" (ngSubmit)="onSubmit()" class="mb-4">
      <input type="hidden" formControlName="id">

      <div class="row g-2 mt-4">
        <div class="col-md-6">
          <label for="nombre" class="form-label">Nombre:</label>
          <input id="nombre" class="form-control" formControlName="nombre" placeholder="Nombre">
          <div *ngIf="nombre?.invalid && (nombre?.dirty || nombre?.touched)" class="text-danger text-start">
            <small *ngIf="nombre?.errors?.['required']">El nombre es requerido</small>
            <small *ngIf="nombre?.errors?.['maxlength']">El nombre no puede exceder 50 caracteres</small>
          </div>
        </div>
        <div class="col-md-6">
          <label for="descripcion" class="form-label">Descripcion:</label>
          <input id="descripcion" class="form-control" formControlName="descripcion" placeholder="Descripcion">
          <div *ngIf="descripcion?.invalid && (descripcion?.dirty || descripcion?.touched)" class="text-danger text-start">
            <small *ngIf="descripcion?.errors?.['required']">La descripción es requerida</small>
            <small *ngIf="descripcion?.errors?.['maxlength']">La descripción no puede exceder 100 caracteres</small>
          </div>
        </div>
      </div>

      <div class="row g-2 mt-4">
        <div class="col-md-6">
          <label for="precio" class="form-label">Precio:</label>
          <input type="number" id="precio" class="form-control" formControlName="precio" placeholder="Precio">
          <div *ngIf="precio?.invalid && (precio?.dirty || precio?.touched)" class="text-danger text-start">
            <small *ngIf="precio?.errors?.['required']">El precio es requerido</small>
            <small *ngIf="precio?.errors?.['min']">El precio no puede ser negativo</small>
          </div>
        </div>
        <div class="col-md-6">
          <label for="stock" class="form-label">Stock:</label>
          <input type="number" id="stock" class="form-control" formControlName="stock" placeholder="Stock">
          <div *ngIf="stock?.invalid && (stock?.dirty || stock?.touched)" class="text-danger text-start">
            <small *ngIf="stock?.errors?.['required']">El stock es requerido</small>
            <small *ngIf="stock?.errors?.['min']">El stock no puede ser negativo</small>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <button type="submit" class="btn btn-success me-2" [disabled]="productoForm.invalid || loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
          {{ isEditMode ? 'Actualizar' : 'Guardar' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="toggleForm()">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
